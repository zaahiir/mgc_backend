<!-- create-member-events.component.html -->
<c-row ngPreserveWhitespaces>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <strong>{{ isEditMode ? 'Edit Member Event' : 'New Member Event' }}</strong>
      </c-card-header>
      <c-card-body>
        <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" #form="ngForm" cForm class="row g-3 needs-validation">
          
          <!-- Basic Information -->
          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="title" formControlName="title" type="text" placeholder="Event Title" />
            <label cLabel for="title" class="ms-2">Event Title *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('title')">
              {{ getErrorMessage('title') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="date" formControlName="date" type="text" placeholder="Display Date (e.g., '22 August')" />
            <label cLabel for="date" class="ms-2">Display Date *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('date')">
              {{ getErrorMessage('date') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="12">
            <input cFormControl id="location" formControlName="location" type="text" placeholder="Event Location" />
            <label cLabel for="location" class="ms-2">Event Location *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('location')">
              {{ getErrorMessage('location') }}
            </c-form-feedback>
          </c-col>

          <!-- Main Image Upload -->
          <c-col md="12">
            <label cLabel for="main_image" class="form-label">Main Event Image *</label>
            <div class="mb-3">
              <input cFormControl id="main_image" type="file" accept="image/*" (change)="onMainImageChange($event)" class="form-control" />
            </div>
            <div *ngIf="imagePreview" class="mb-3">
              <img [src]="imagePreview" alt="Main Image Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" />
              <button type="button" cButton color="danger" size="sm" class="ms-2" (click)="removeMainImage()">Remove</button>
            </div>
          </c-col>

          <!-- Additional Images -->
          <c-col md="12">
            <label cLabel class="form-label">Additional Images</label>
            <div class="row">
              <c-col md="3" *ngFor="let i of [1,2,3,4]">
                <div class="mb-3">
                  <input cFormControl [id]="'image_' + i" type="file" accept="image/*" (change)="onAdditionalImageChange($event, 'image_' + i)" class="form-control" />
                  <div *ngIf="additionalImagePreviews['image_' + i]" class="mt-2">
                    <img [src]="additionalImagePreviews['image_' + i]" [alt]="'Image ' + i + ' Preview'" class="img-thumbnail" style="max-width: 150px; max-height: 150px;" />
                    <button type="button" cButton color="danger" size="sm" class="ms-1" (click)="removeAdditionalImage('image_' + i)">Remove</button>
                  </div>
                </div>
              </c-col>
            </div>
          </c-col>

          <!-- Event Content -->
          <c-col [cFormFloating]="true" md="12">
            <textarea cFormControl id="description" formControlName="description" placeholder="Main Event Description" rows="4"></textarea>
            <label cLabel for="description" class="ms-2">Main Event Description *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('description')">
              {{ getErrorMessage('description') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="12">
            <textarea cFormControl id="additional_info" formControlName="additional_info" placeholder="Additional Information" rows="3"></textarea>
            <label cLabel for="additional_info" class="ms-2">Additional Information</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('additional_info')">
              {{ getErrorMessage('additional_info') }}
            </c-form-feedback>
          </c-col>

          <!-- Activities Section -->
          <c-col [cFormFloating]="true" md="12">
            <textarea cFormControl id="activities_description" formControlName="activities_description" placeholder="Description of Activities and Features" rows="4"></textarea>
            <label cLabel for="activities_description" class="ms-2">Activities Description *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('activities_description')">
              {{ getErrorMessage('activities_description') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="12">
            <textarea cFormControl id="additional_activities" formControlName="additional_activities" placeholder="Additional Activities Information" rows="3"></textarea>
            <label cLabel for="additional_activities" class="ms-2">Additional Activities</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('additional_activities')">
              {{ getErrorMessage('additional_activities') }}
            </c-form-feedback>
          </c-col>

          <!-- Event Details -->
          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="organizer" formControlName="organizer" type="text" placeholder="Event Organizer" />
            <label cLabel for="organizer" class="ms-2">Event Organizer *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('organizer')">
              {{ getErrorMessage('organizer') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="start_date" formControlName="start_date" type="date" />
            <label cLabel for="start_date" class="ms-2">Start Date *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('start_date')">
              {{ getErrorMessage('start_date') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="end_date" formControlName="end_date" type="date" />
            <label cLabel for="end_date" class="ms-2">End Date *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('end_date')">
              {{ getErrorMessage('end_date') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="time" formControlName="time" type="text" placeholder="Event Time (e.g., '12:00 PM')" />
            <label cLabel for="time" class="ms-2">Event Time *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('time')">
              {{ getErrorMessage('time') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="cost" formControlName="cost" type="text" placeholder="Event Cost (e.g., '$60')" />
            <label cLabel for="cost" class="ms-2">Event Cost *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('cost')">
              {{ getErrorMessage('cost') }}
            </c-form-feedback>
          </c-col>

          <!-- Venue Information -->
          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="venue" formControlName="venue" type="text" placeholder="Venue Name" />
            <label cLabel for="venue" class="ms-2">Venue Name *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('venue')">
              {{ getErrorMessage('venue') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="12">
            <textarea cFormControl id="address" formControlName="address" placeholder="Venue Address" rows="3"></textarea>
            <label cLabel for="address" class="ms-2">Venue Address *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('address')">
              {{ getErrorMessage('address') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="email" formControlName="email" type="email" placeholder="Contact Email" />
            <label cLabel for="email" class="ms-2">Contact Email *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('email')">
              {{ getErrorMessage('email') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="phone" formControlName="phone" type="text" placeholder="Contact Phone" />
            <label cLabel for="phone" class="ms-2">Contact Phone *</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('phone')">
              {{ getErrorMessage('phone') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="website" formControlName="website" type="url" placeholder="Venue Website" />
            <label cLabel for="website" class="ms-2">Venue Website</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('website')">
              {{ getErrorMessage('website') }}
            </c-form-feedback>
          </c-col>

          <!-- Event Options -->
          <c-col md="12">
            <label cLabel class="form-label">Event Options (for contact form dropdown)</label>
            <div class="border p-3 rounded">
              <div class="row" *ngFor="let option of eventForm.get('event_options')?.value; let i = index">
                <c-col md="5">
                  <input cFormControl [id]="'option_value_' + i" type="text" [value]="option.value" placeholder="Value" class="form-control" />
                </c-col>
                <c-col md="5">
                  <input cFormControl [id]="'option_label_' + i" type="text" [value]="option.label" placeholder="Label" class="form-control" />
                </c-col>
                <c-col md="2">
                  <button type="button" cButton color="danger" size="sm" (click)="removeEventOption(i)">Remove</button>
                </c-col>
              </div>
              <button type="button" cButton color="primary" size="sm" class="mt-2" (click)="addEventOption()">Add Option</button>
            </div>
          </c-col>

          <!-- Status and Visibility -->
          <c-col md="6">
            <div class="form-check">
              <input cFormControl id="is_active" formControlName="is_active" type="checkbox" class="form-check-input" />
              <label cLabel for="is_active" class="form-check-label">Active Event</label>
            </div>
          </c-col>

          <c-col md="6">
            <div class="form-check">
              <input cFormControl id="is_featured" formControlName="is_featured" type="checkbox" class="form-check-input" />
              <label cLabel for="is_featured" class="form-check-label">Featured Event</label>
            </div>
          </c-col>

          <!-- SEO and Meta -->
          <c-col [cFormFloating]="true" md="12">
            <textarea cFormControl id="meta_description" formControlName="meta_description" placeholder="SEO Meta Description (max 160 characters)" rows="2"></textarea>
            <label cLabel for="meta_description" class="ms-2">SEO Meta Description</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('meta_description')">
              {{ getErrorMessage('meta_description') }}
            </c-form-feedback>
          </c-col>

          <c-col [cFormFloating]="true" md="6">
            <input cFormControl id="slug" formControlName="slug" type="text" placeholder="URL Slug (auto-generated if empty)" />
            <label cLabel for="slug" class="ms-2">URL Slug</label>
            <c-form-feedback [valid]="false" *ngIf="isFieldInvalid('slug')">
              {{ getErrorMessage('slug') }}
            </c-form-feedback>
          </c-col>

          <!-- Form Actions -->
          <c-col xs="12" class="d-flex gap-2">
            <button cButton color="primary" type="submit" [disabled]="loading">
              <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
              {{ isEditMode ? 'Update Event' : 'Create Event' }}
            </button>
            
            <button cButton color="secondary" type="button" (click)="onReset()" [disabled]="loading">
              Reset
            </button>
            
            <button *ngIf="isEditMode" cButton color="danger" type="button" (click)="onDelete()" [disabled]="loading">
              Delete Event
            </button>
            
            <button cButton color="info" type="button" (click)="router.navigate(['/member-events'])" [disabled]="loading">
              Back to Events
            </button>
          </c-col>
        </form>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>
