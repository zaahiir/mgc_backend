<section class="page-title d-flex justify-content-center align-items-center">
  <div class="bg-layer" [style.background-image]="'url(' + course.imageUrl + ')'"></div>
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h1>{{course.name}}</h1>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <fa-icon [icon]="locationIcon"></fa-icon>
              {{course.lane}}, {{course.address}}
            </li>
            <li class="breadcrumb-item">
              <fa-icon [icon]="clockIcon"></fa-icon>
              {{course.timing}}
            </li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</section>

<!-- Main Content Section -->
<section class="course-section">
  <div class="container">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-4 col-md-12 order-lg-1 order-2">
        <!-- Booking Form Widget -->
        <div class="sidebar-widget">
          <div class="widget-title">
            <h3>Book Your Tee Time</h3>
          </div>

          <div class="booking-form">
            <!-- Step 1: Participants -->
            <div class="form-section">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="usersIcon" class="section-icon"></fa-icon>
                  <label>Participants</label>
                </div>
              </div>
              <div class="player-selector">
                <button class="circle-btn" (click)="decrementParticipants()" [disabled]="participantCount === 1">-</button>
                <span class="player-count">{{participantCount}}</span>
                <button class="circle-btn" (click)="incrementParticipants()" [disabled]="participantCount === maxParticipants">+</button>
              </div>
            </div>

            <!-- Step 2: Tee Selection (only visible after participants selected) -->
            <div class="form-section" *ngIf="participantCount > 0">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="golfIcon" class="section-icon"></fa-icon>
                  <label>Select Tee</label>
                </div>
              </div>
              
              <div class="tee-options">
                <button class="tee-option" 
                        *ngFor="let tee of availableTees"
                        [class.selected]="selectedTee?.id === tee.id"
                        (click)="selectTee(tee)">
                  <span class="tee-name">{{tee.label || (tee.holeNumber + ' Holes')}}</span>
                </button>
                
                <!-- Show message when no tees available -->
                <div *ngIf="availableTees.length === 0 && !isLoading" class="no-tees-message">
                  <p>No tees available for this course.</p>
                  <button class="theme-btn" (click)="loadAvailableTees()">Retry Loading Tees</button>
                </div>
                
                <!-- Show loading state -->
                <div *ngIf="isLoading" class="loading-message">
                  <p>Loading available tees...</p>
                </div>
              </div>
            </div>

            <!-- Step 3: Date Selection (only visible after tee selected) -->
            <div class="form-section" *ngIf="selectedTee">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="calendarIcon" class="section-icon"></fa-icon>
                  <label>Select Date</label>
                </div>
              </div>

              <!-- Current Date Display -->
              <div class="current-date-display" (click)="toggleCalendar()">
                <div class="date-info">
                  <span class="date-value">{{selectedDate | date:'MMM d, yyyy'}}</span>
                  <span class="date-day">{{selectedDate | date:'EEEE'}}</span>
                </div>
                <div class="calendar-toggle-icon">
                  <fa-icon [icon]="showCalendar ? chevronUpIcon : chevronDownIcon"></fa-icon>
                </div>
              </div>

              <!-- Calendar View (Collapsible) -->
              <div class="calendar-view" [class.show]="showCalendar">
                <div class="calendar-header">
                  <button class="month-nav" (click)="previousMonth()">
                    <fa-icon [icon]="chevronLeftIcon"></fa-icon>
                  </button>
                  <span class="current-month">{{currentDate | date:'MMMM yyyy'}}</span>
                  <button class="month-nav" (click)="nextMonth()">
                    <fa-icon [icon]="chevronRightIcon"></fa-icon>
                  </button>
                </div>
                <div class="calendar-weekdays">
                  <span *ngFor="let day of weekDays">{{day}}</span>
                </div>
                <div class="calendar-days">
                  <button *ngFor="let day of calendarDays"
                          class="calendar-day"
                          [class.selected]="isDateSelected(day.date)"
                          [class.today]="isToday(day.date)"
                          [class.available]="day.available"
                          [class.other-month]="day.otherMonth"
                          [disabled]="!day.available || day.otherMonth"
                          (click)="selectDate(day.date)">
                    <div class="day-number">{{day.date | date:'d'}}</div>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 4: Time Selection (only visible after date selected) -->
            <div class="form-section" *ngIf="selectedDate && selectedTee">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="clockIcon" class="section-icon"></fa-icon>
                  <label>Available Times</label>
                </div>
              </div>
              
              <!-- Show message when selected date is today -->
              <div class="today-notice" *ngIf="isSelectedDateToday()">
                <p><small>Showing only future time slots for today (30+ minutes from now)</small></p>
              </div>
              
              <div class="time-slots-container">
                <div class="time-slots-grid">
                  <button *ngFor="let slot of currentTimeSlots"
                          class="time-slot"
                          [class.selected]="selectedTime === slot.time"
                          [class.unavailable]="!slot.available"
                          [disabled]="!slot.available"
                          (click)="selectTime(slot.time)"
                          [title]="getSlotTooltip(slot)">
                    <div class="time-slot-content">
                      <span class="time">{{slot.time}}</span>
                      <div class="golf-ball" [class.available]="slot.available">
                        <div class="dimples">
                          <div class="dimple"></div>
                          <div class="dimple"></div>
                          <div class="dimple"></div>
                        </div>
                      </div>
                      <!-- Show booking count if slot has bookings -->
                      <div class="booking-indicator" *ngIf="slot.booking_count && slot.booking_count > 0">
                        <span class="booking-count">{{slot.booking_count}}</span>
                      </div>
                    </div>
                    <!-- Show booking details on hover for booked slots -->
                    <div class="booking-details" *ngIf="slot.bookings && slot.bookings.length > 0">
                      <div class="booking-detail" *ngFor="let booking of slot.bookings">
                        <div class="booking-info">
                          <span class="member-name">{{booking.member_name}}</span>
                          <span class="booking-time">{{booking.start_time}} - {{booking.end_time}}</span>
                          <span class="participants">{{booking.participants}} player{{booking.participants > 1 ? 's' : ''}}</span>
                          <span class="hole-number">{{booking.hole_number}} holes</span>
                        </div>
                      </div>
                    </div>
                  </button>
                </div>
                
                <!-- Show message when no time slots are available -->
                <div *ngIf="currentTimeSlots.length === 0 && !isLoading" class="no-slots-message">
                  <p *ngIf="isSelectedDateToday()">No available time slots for today. Please select a future date.</p>
                  <p *ngIf="!isSelectedDateToday()">No available time slots for the selected date.</p>
                </div>
              </div>
            </div>

            <!-- Booking Summary (only visible when all steps completed) -->
            <div class="booking-summary" *ngIf="canBook()">
              <div class="summary-header">
                <h4>Booking Summary</h4>
              </div>
              <div class="summary-details">
                <div class="summary-item">
                  <span class="label">Tee:</span>
                  <span class="value">{{selectedTee?.label}}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Date:</span>
                  <span class="value">{{selectedDate | date:'MMM d, yyyy'}}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Time:</span>
                  <span class="value">{{selectedTime}}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Participants:</span>
                  <span class="value">{{participantCount}}</span>
                </div>
              </div>
            </div>

            <button class="theme-btn w-100"
                    [disabled]="!canBook()"
                    [class.loading]="isLoading"
                    (click)="bookTeeTime()">
              {{isLoading ? 'Booking...' : 'Book Now'}}
            </button>
            
            <!-- Login prompt for unauthenticated users -->
            <div class="login-prompt" *ngIf="!isAuthenticated()">
              <p><small>Please log in to book a tee time</small></p>
            </div>

            <div class="success-message" *ngIf="successMessage">
              {{successMessage}}
            </div>

            <div class="error-message" *ngIf="errorMessage">
              {{errorMessage}}
            </div>
          </div>
        </div>
        
        <!-- Optimized Contact & Directions Widget -->
        <div class="contact-directions-widget">
          <div class="widget-header">
            <h3><fa-icon [icon]="locationIcon"></fa-icon> Contact & Directions</h3>
          </div>
          
          <div class="contact-info">
            <div class="info-item" (click)="copyToClipboard(course.address)">
              <div class="icon-wrapper">
                <fa-icon [icon]="locationIcon"></fa-icon>
              </div>
              <div class="info-content">
                <span class="label">Location</span>
                <span class="value">{{course.address}}</span>
              </div>
              <div class="action-icon">
                <fa-icon [icon]="copyIcon" title="Copy address"></fa-icon>
              </div>
            </div>

            <div class="info-item" (click)="makeCall()">
              <div class="icon-wrapper">
                <fa-icon [icon]="phoneIcon"></fa-icon>
              </div>
              <div class="info-content">
                <span class="label">Phone</span>
                <span class="value">{{course.phone}}</span>
              </div>
              <div class="action-icon">
                <fa-icon [icon]="phoneIcon" title="Call now"></fa-icon>
              </div>
            </div>
          </div>

          <div class="direction-actions">
            <button class="action-btn primary" (click)="getDirections()">
              <fa-icon [icon]="directionsIcon"></fa-icon>
              <span>Get Directions</span>
            </button>
            <button class="action-btn secondary" (click)="shareLocation()">
              <fa-icon [icon]="shareIcon"></fa-icon>
              <span>Share Location</span>
            </button>
          </div>


        </div>
      </div>

      <!-- Main Content -->
      <div class="col-lg-8 col-md-12 order-lg-2 order-1">
        <div class="main-content">
          <!-- Course Image -->
          <img [src]="course.imageUrl"
               alt="{{course.name}}"
               class="hero-image">

          <!-- Hours Information (Moved here) -->
          <div class="hours-section">
            <div class="hours-info">
              <fa-icon [icon]="clockIcon" class="hours-icon"></fa-icon>
              <div class="hours-content">
                <span class="hours-label">Hours</span>
                <span class="hours-value">{{course.timing}}</span>
              </div>
              <div class="status-badge open">OPEN</div>
            </div>
          </div>

          <!-- Course Information -->
          <div class="content-section">
            <h2>About {{course.name}}</h2>
            <p *ngIf="course.description">{{course.description}}</p>
            <p *ngIf="!course.description">Experience exceptional golfing conditions with our meticulously maintained fairways, challenging layout, and stunning natural surroundings. Perfect for golfers of all skill levels.</p>

            
            <h3>Our facilities include</h3>
            <div class="amenities-grid" *ngIf="course.amenities && course.amenities.length > 0">
              <div class="amenity-item" *ngFor="let amenity of course.amenities; trackBy: trackByAmenity">
                <div class="amenity-icon-wrapper">
                  <div class="amenity-icon" *ngIf="getSafeSvgIcon(amenity)" [innerHTML]="getSafeSvgIcon(amenity)"></div>
                  <fa-icon *ngIf="!getSafeSvgIcon(amenity)" [icon]="getAmenityIcon(amenity)"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">{{amenity.amenityName}}</h4>
                  <p class="amenity-description">{{amenity.amenitiesDescription || amenity.amenityTooltip}}</p>
                </div>
              </div>
            </div>
            
            <!-- Fallback facilities if no amenities are available -->
            <div class="amenities-grid" *ngIf="!course.amenities || course.amenities.length === 0">
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="wifiIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Free WiFi</h4>
                  <p class="amenity-description">Stay connected throughout your visit with complimentary high-speed internet access.</p>
                </div>
              </div>
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="parkingIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Free Parking</h4>
                  <p class="amenity-description">Convenient and secure parking facilities available for all guests.</p>
                </div>
              </div>
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="restaurantIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Restaurant</h4>
                  <p class="amenity-description">Enjoy delicious meals and refreshments at our on-site restaurant.</p>
                </div>
              </div>
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="shopIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Pro Shop</h4>
                  <p class="amenity-description">Browse our fully-stocked pro shop for all your golfing needs.</p>
                </div>
              </div>
            </div>

            <!-- Benefit Section -->
            <!-- <div class="benefit-section">
              <img src="https://images.unsplash.com/photo-1593111774240-d529f12cf4bb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=400&q=80"
                   alt="Golf Experience" class="benefit-image">
              <div class="benefit-content">
                <h3>Why Choose Our Course?</h3>
                <p>Experience exceptional golfing conditions with our meticulously maintained fairways, challenging layout, and stunning natural surroundings. Perfect for golfers of all skill levels.</p>
                <p><strong>Price:</strong> Contact for pricing</p>
              </div>
            </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Booking Confirmation Modal -->
<div class="modal-overlay" *ngIf="showBookingModal" (click)="closeBookingModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Booking Confirmation</h3>
      <button class="modal-close" (click)="closeBookingModal()">
        <fa-icon [icon]="chevronUpIcon"></fa-icon>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="bookingConfirmationData">
      <div class="confirmation-icon">
        <fa-icon [icon]="golfIcon"></fa-icon>
      </div>
      
      <div class="confirmation-message">
        <h4>Your tee time has been booked successfully!</h4>
        <p>Booking ID: #{{bookingConfirmationData.bookingId}}</p>
      </div>
      
      <div class="booking-details">
        <div class="detail-item">
          <span class="label">Course:</span>
          <span class="value">{{bookingConfirmationData.courseName}}</span>
        </div>
        <div class="detail-item">
          <span class="label">Tee:</span>
          <span class="value">{{bookingConfirmationData.teeLabel}}</span>
        </div>
        <div class="detail-item">
          <span class="label">Date:</span>
          <span class="value">{{bookingConfirmationData.date | date:'MMM d, yyyy'}}</span>
        </div>
        <div class="detail-item">
          <span class="label">Time:</span>
          <span class="value">{{bookingConfirmationData.time}}</span>
        </div>
        <div class="detail-item">
          <span class="label">Participants:</span>
          <span class="value">{{bookingConfirmationData.participants}}</span>
        </div>
        <div class="detail-item">
          <span class="label">Status:</span>
          <span class="value status-pending">{{bookingConfirmationData.status}}</span>
        </div>
      </div>
      
      <div class="confirmation-actions">
        <button class="theme-btn" (click)="closeBookingModal()">
          Done
        </button>
      </div>
    </div>
  </div>
</div>